name: 🌐 Deploy GitHub Pages

on:
    push:
        branches: [master]
        paths:
            - 'docs/**'
            - 'README.md'
            - 'CHANGELOG.md'
            - 'package.json'
    workflow_dispatch:

permissions:
    contents: read
    pages: write
    id-token: write

# Allow only one concurrent deployment, skipping runs queued between the run in-progress and latest queued.
concurrency:
    group: 'pages'
    cancel-in-progress: false

jobs:
    build:
        name: 🏗️ Build Documentation Site
        runs-on: ubuntu-latest
        if: github.ref == 'refs/heads/master'

        permissions:
            contents: read

        steps:
            - name: 📥 Checkout code
              uses: actions/checkout@v4
              with:
                  fetch-depth: 0

            - name: 📦 Setup pnpm
              uses: pnpm/action-setup@v4
              with:
                  version: latest

            - name: 🟢 Setup Node.js
              uses: actions/setup-node@v4
              with:
                  node-version: '20'
                  cache: 'pnpm'

            - name: 📚 Install dependencies
              run: pnpm install --frozen-lockfile

            - name: 🏗️ Build extension
              run: pnpm run package

            - name: 📋 Extract extension metadata
              id: metadata
              run: |
                  version=$(node -p "require('./package.json').version")
                  name=$(node -p "require('./package.json').displayName")
                  description=$(node -p "require('./package.json').description")

                  echo "version=$version" >> $GITHUB_OUTPUT
                  echo "name=$name" >> $GITHUB_OUTPUT
                  echo "description=$description" >> $GITHUB_OUTPUT

                  # Generate feature list from package.json
                  echo "features<<EOF" >> $GITHUB_OUTPUT
                  node -e "
                    const pkg = require('./package.json');
                    const commands = pkg.contributes?.commands || [];
                    const config = pkg.contributes?.configuration?.properties || {};
                    
                    console.log('## 🎯 Commands');
                    commands.forEach(cmd => {
                      console.log(\`- **\${cmd.title}**: \${cmd.command}\`);
                    });
                    
                    console.log('\\n## ⚙️ Configuration');
                    Object.entries(config).forEach(([key, value]) => {
                      console.log(\`- **\${key}**: \${value.description}\`);
                    });
                  " >> $GITHUB_OUTPUT
                  echo "EOF" >> $GITHUB_OUTPUT

            - name: 📂 Create docs directory structure
              run: |
                  mkdir -p docs/{assets,guides,api}
                  mkdir -p docs/assets/{css,js,images}

            - name: 🎨 Generate CSS styles
              run: |
                  cat > docs/assets/css/styles.css << 'EOF'
                  /* 🎨 VS Code Theme Inspired Styles */
                  :root {
                    --vscode-bg: #1e1e1e;
                    --vscode-fg: #d4d4d4;
                    --vscode-accent: #007acc;
                    --vscode-accent-hover: #1177bb;
                    --vscode-sidebar: #252526;
                    --vscode-border: #3c3c3c;
                    --vscode-success: #89d185;
                    --vscode-warning: #ffcc02;
                    --vscode-error: #f85149;
                    --vscode-info: #75beff;
                  }

                  * {
                    margin: 0;
                    padding: 0;
                    box-sizing: border-box;
                  }

                  body {
                    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
                    background: var(--vscode-bg);
                    color: var(--vscode-fg);
                    line-height: 1.6;
                    overflow-x: hidden;
                  }

                  .container {
                    max-width: 1200px;
                    margin: 0 auto;
                    padding: 0 20px;
                  }

                  /* 🌟 Header */
                  .hero {
                    background: linear-gradient(135deg, var(--vscode-bg) 0%, var(--vscode-sidebar) 100%);
                    padding: 4rem 0;
                    text-align: center;
                    border-bottom: 2px solid var(--vscode-border);
                  }

                  .hero h1 {
                    font-size: 3.5rem;
                    margin-bottom: 1rem;
                    background: linear-gradient(45deg, var(--vscode-accent), var(--vscode-info));
                    -webkit-background-clip: text;
                    -webkit-text-fill-color: transparent;
                    background-clip: text;
                  }

                  .hero .subtitle {
                    font-size: 1.25rem;
                    margin-bottom: 2rem;
                    opacity: 0.8;
                  }

                  .hero .badges {
                    display: flex;
                    justify-content: center;
                    flex-wrap: wrap;
                    gap: 10px;
                    margin: 2rem 0;
                  }

                  .badge {
                    padding: 8px 16px;
                    background: var(--vscode-sidebar);
                    border: 1px solid var(--vscode-border);
                    border-radius: 20px;
                    color: var(--vscode-fg);
                    text-decoration: none;
                    font-size: 0.9rem;
                    transition: all 0.3s ease;
                  }

                  .badge:hover {
                    background: var(--vscode-accent);
                    transform: translateY(-2px);
                  }

                  /* 🎯 Navigation */
                  .nav {
                    background: var(--vscode-sidebar);
                    padding: 1rem 0;
                    position: sticky;
                    top: 0;
                    z-index: 100;
                    border-bottom: 1px solid var(--vscode-border);
                  }

                  .nav ul {
                    list-style: none;
                    display: flex;
                    justify-content: center;
                    flex-wrap: wrap;
                    gap: 2rem;
                  }

                  .nav a {
                    color: var(--vscode-fg);
                    text-decoration: none;
                    padding: 0.5rem 1rem;
                    border-radius: 5px;
                    transition: all 0.3s ease;
                  }

                  .nav a:hover {
                    background: var(--vscode-accent);
                    color: white;
                  }

                  /* 📋 Content sections */
                  .section {
                    padding: 3rem 0;
                    border-bottom: 1px solid var(--vscode-border);
                  }

                  .section h2 {
                    font-size: 2.5rem;
                    margin-bottom: 2rem;
                    text-align: center;
                    color: var(--vscode-accent);
                  }

                  .grid {
                    display: grid;
                    grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
                    gap: 2rem;
                    margin: 2rem 0;
                  }

                  .card {
                    background: var(--vscode-sidebar);
                    border: 1px solid var(--vscode-border);
                    border-radius: 10px;
                    padding: 2rem;
                    transition: all 0.3s ease;
                  }

                  .card:hover {
                    transform: translateY(-5px);
                    border-color: var(--vscode-accent);
                  }

                  .card h3 {
                    color: var(--vscode-info);
                    margin-bottom: 1rem;
                    font-size: 1.5rem;
                  }

                  /* 🎨 Code blocks */
                  pre, code {
                    background: #0d1117;
                    color: #e6edf3;
                    border-radius: 6px;
                    font-family: 'Consolas', 'Monaco', 'Courier New', monospace;
                  }

                  pre {
                    padding: 1rem;
                    overflow-x: auto;
                    margin: 1rem 0;
                    border: 1px solid var(--vscode-border);
                  }

                  code {
                    padding: 0.2rem 0.4rem;
                    font-size: 0.9em;
                  }

                  /* 🔘 Buttons */
                  .btn {
                    display: inline-block;
                    padding: 12px 24px;
                    background: var(--vscode-accent);
                    color: white;
                    text-decoration: none;
                    border-radius: 6px;
                    transition: all 0.3s ease;
                    border: none;
                    cursor: pointer;
                    font-size: 1rem;
                  }

                  .btn:hover {
                    background: var(--vscode-accent-hover);
                    transform: translateY(-2px);
                  }

                  .btn-secondary {
                    background: var(--vscode-sidebar);
                    border: 1px solid var(--vscode-border);
                  }

                  /* 📱 Responsive */
                  @media (max-width: 768px) {
                    .hero h1 {
                      font-size: 2.5rem;
                    }
                    
                    .nav ul {
                      flex-direction: column;
                      text-align: center;
                    }
                    
                    .grid {
                      grid-template-columns: 1fr;
                    }
                  }

                  /* ✨ Animations */
                  @keyframes fadeInUp {
                    from {
                      opacity: 0;
                      transform: translateY(30px);
                    }
                    to {
                      opacity: 1;
                      transform: translateY(0);
                    }
                  }

                  .animate-fade-in {
                    animation: fadeInUp 0.6s ease-out;
                  }

                  /* 🎪 Fun effects */
                  .emoji {
                    font-size: 1.2em;
                    margin-right: 0.5rem;
                  }

                  .highlight {
                    background: linear-gradient(120deg, var(--vscode-accent) 0%, var(--vscode-info) 100%);
                    -webkit-background-clip: text;
                    -webkit-text-fill-color: transparent;
                    background-clip: text;
                    font-weight: bold;
                  }
                  EOF

            - name: 🚀 Generate JavaScript functionality
              run: |
                  cat > docs/assets/js/main.js << 'EOF'
                  // 🎪 Interactive Documentation Features

                  document.addEventListener('DOMContentLoaded', function() {
                    console.log('🎉 Keypress Notifications docs loaded!');
                    
                    // ✨ Smooth scrolling for navigation
                    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
                      anchor.addEventListener('click', function (e) {
                        e.preventDefault();
                        const target = document.querySelector(this.getAttribute('href'));
                        if (target) {
                          target.scrollIntoView({
                            behavior: 'smooth',
                            block: 'start'
                          });
                        }
                      });
                    });
                    
                    // 🎯 Animate elements on scroll
                    const observerOptions = {
                      threshold: 0.1,
                      rootMargin: '0px 0px -50px 0px'
                    };
                    
                    const observer = new IntersectionObserver((entries) => {
                      entries.forEach(entry => {
                        if (entry.isIntersecting) {
                          entry.target.classList.add('animate-fade-in');
                        }
                      });
                    }, observerOptions);
                    
                    // Observe all cards and sections
                    document.querySelectorAll('.card, .section').forEach(el => {
                      observer.observe(el);
                    });
                    
                    // 📋 Copy code functionality
                    document.querySelectorAll('pre').forEach(pre => {
                      const button = document.createElement('button');
                      button.innerHTML = '📋 Copy';
                      button.className = 'btn btn-secondary copy-btn';
                      button.style.cssText = 'position: absolute; top: 10px; right: 10px; font-size: 0.8rem; padding: 4px 8px;';
                      
                      pre.style.position = 'relative';
                      pre.appendChild(button);
                      
                      button.addEventListener('click', async () => {
                        try {
                          await navigator.clipboard.writeText(pre.textContent);
                          button.innerHTML = '✅ Copied!';
                          setTimeout(() => {
                            button.innerHTML = '📋 Copy';
                          }, 2000);
                        } catch (err) {
                          console.error('Failed to copy:', err);
                          button.innerHTML = '❌ Failed';
                          setTimeout(() => {
                            button.innerHTML = '📋 Copy';
                          }, 2000);
                        }
                      });
                    });
                    
                    // 🔍 Simple search functionality
                    const searchInput = document.getElementById('search');
                    if (searchInput) {
                      searchInput.addEventListener('input', function() {
                        const query = this.value.toLowerCase();
                        const sections = document.querySelectorAll('.section, .card');
                        
                        sections.forEach(section => {
                          const text = section.textContent.toLowerCase();
                          const match = text.includes(query);
                          section.style.display = match || query === '' ? 'block' : 'none';
                        });
                      });
                    }
                  });

                  // 🎨 Theme switcher (bonus feature)
                  function toggleTheme() {
                    const root = document.documentElement;
                    const currentTheme = root.style.getPropertyValue('--vscode-bg');
                    
                    if (currentTheme === '#ffffff') {
                      // Switch to dark
                      root.style.setProperty('--vscode-bg', '#1e1e1e');
                      root.style.setProperty('--vscode-fg', '#d4d4d4');
                      root.style.setProperty('--vscode-sidebar', '#252526');
                    } else {
                      // Switch to light
                      root.style.setProperty('--vscode-bg', '#ffffff');
                      root.style.setProperty('--vscode-fg', '#333333');
                      root.style.setProperty('--vscode-sidebar', '#f3f3f3');
                    }
                  }
                  EOF

            - name: 📝 Generate main documentation page
              run: |
                  cat > docs/index.html << 'EOF'
                  <!DOCTYPE html>
                  <html lang="en">
                  <head>
                    <meta charset="UTF-8">
                    <meta name="viewport" content="width=device-width, initial-scale=1.0">
                    <title>⌨️ Keypress Notifications - VS Code Extension</title>
                    <meta name="description" content="Get instant visual feedback for multi-key combinations and command executions in VS Code. Never miss a keybinding action again!">
                    
                    <!-- 🎨 Stylesheets -->
                    <link rel="stylesheet" href="./assets/css/styles.css">
                    
                    <!-- 🔍 Search Engine Optimization -->
                    <meta property="og:title" content="Keypress Notifications for VS Code">
                    <meta property="og:description" content="Visual feedback for VS Code keybindings and commands">
                    <meta property="og:type" content="website">
                    <meta property="og:url" content="https://vijay431.github.io/vscode-keypress_snackbar_notification-extension/">
                    
                    <!-- 🎯 Favicon -->
                    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>⌨️</text></svg>">
                  </head>
                  <body>
                    <!-- 🌟 Hero Section -->
                    <header class="hero">
                      <div class="container">
                        <h1>⌨️ Keypress Notifications</h1>
                        <p class="subtitle">🎯 Never miss a keybinding action again! Get instant visual feedback for multi-key combinations and command executions in VS Code.</p>
                        
                        <div class="badges">
                          <a href="#" class="badge">📦 v${{ steps.metadata.outputs.version }}</a>
                          <a href="#" class="badge">🟢 Node 16+</a>
                          <a href="#" class="badge">💻 VS Code 1.90.0+</a>
                          <a href="#" class="badge">⭐ MIT License</a>
                        </div>
                        
                        <div style="margin-top: 2rem;">
                          <a href="https://marketplace.visualstudio.com/items?itemName=VijayGangatharan.keypress-notifications" class="btn">📦 Install Now</a>
                          <a href="https://github.com/Vijay431/vscode-keypress_snackbar_notification-extension" class="btn btn-secondary">🐙 View Source</a>
                        </div>
                      </div>
                    </header>
                    
                    <!-- 🎯 Navigation -->
                    <nav class="nav">
                      <div class="container">
                        <ul>
                          <li><a href="#features">✨ Features</a></li>
                          <li><a href="#installation">📦 Installation</a></li>
                          <li><a href="#configuration">⚙️ Configuration</a></li>
                          <li><a href="#compatibility">🔧 Compatibility</a></li>
                          <li><a href="#contributing">🤝 Contributing</a></li>
                        </ul>
                      </div>
                    </nav>
                    
                    <!-- ✨ Features Section -->
                    <section id="features" class="section">
                      <div class="container">
                        <h2>🎮 Features That Make Your Workflow Shine</h2>
                        
                        <div class="grid">
                          <div class="card">
                            <h3>⌨️ Smart Keybinding Detection</h3>
                            <p>Get instant notifications for:</p>
                            <ul>
                              <li>📄 <strong>Copy (Ctrl+C)</strong> → "Copy detected! 📄✨"</li>
                              <li>✂️ <strong>Cut (Ctrl+X)</strong> → "Cut detected! ✂️💫"</li>
                              <li>📋 <strong>Paste (Ctrl+V)</strong> → "Paste detected! 📋🎯"</li>
                              <li>💾 <strong>Save All (Ctrl+K S)</strong> → "Save All detected! 💾🔥"</li>
                              <li>🔍 <strong>Find in Files (Ctrl+Shift+F)</strong> → "Find in Files detected! 🔍⚡"</li>
                            </ul>
                          </div>
                          
                          <div class="card">
                            <h3>🎛️ Command Integration</h3>
                            <p>Control the extension with VS Code commands:</p>
                            <ul>
                              <li>🟢 <strong>Activate</strong> - Turn on notifications</li>
                              <li>🔴 <strong>Deactivate</strong> - Turn off notifications</li>
                              <li>📊 <strong>Show Output Channel</strong> - Open debug console</li>
                            </ul>
                          </div>
                          
                          <div class="card">
                            <h3>⚡ Performance & Reliability</h3>
                            <ul>
                              <li>🚀 <strong>Auto-activates</strong> on VS Code startup</li>
                              <li>🏗️ <strong>Modular architecture</strong> for reliability</li>
                              <li>🔧 <strong>Fully configurable</strong> via settings</li>
                              <li>🎯 <strong>Zero performance impact</strong> on workflow</li>
                              <li>🧪 <strong>Comprehensive tests</strong> for stability</li>
                            </ul>
                          </div>
                        </div>
                      </div>
                    </section>
                    
                    <!-- 📦 Installation Section -->
                    <section id="installation" class="section">
                      <div class="container">
                        <h2>🚀 Get Started in 30 Seconds</h2>
                        
                        <div class="grid">
                          <div class="card">
                            <h3>💻 Command Line Installation</h3>
                            <pre><code># Quick install via VS Code CLI
                  code --install-extension VijayGangatharan.keypress-notifications</code></pre>
                          </div>
                          
                          <div class="card">
                            <h3>🎯 GUI Installation</h3>
                            <ol>
                              <li>🔍 Open Extensions (<code>Ctrl+Shift+X</code>)</li>
                              <li>🔎 Search "Keypress Notifications"</li>
                              <li>📦 Click <strong>Install</strong></li>
                              <li>🎉 You're done!</li>
                            </ol>
                          </div>
                        </div>
                        
                        <div style="text-align: center; margin-top: 2rem;">
                          <p>🎯 <strong>No setup needed!</strong> Just start using your keybindings and see notifications instantly.</p>
                        </div>
                      </div>
                    </section>
                    
                    <!-- ⚙️ Configuration Section -->
                    <section id="configuration" class="section">
                      <div class="container">
                        <h2>⚙️ Customize Your Experience</h2>
                        
                        <div class="card">
                          <h3>🔧 Configuration Options</h3>
                          <pre><code>{
                    "keypress-notifications.enabled": true,
                    "keypress-notifications.logLevel": "info",
                    "keypress-notifications.minimumKeys": 2,
                    "keypress-notifications.showCommandName": true,
                    "keypress-notifications.excludedCommands": [
                      "editor.action.triggerSuggest",
                      "workbench.action.quickOpenNavigateNext"
                    ]
                  }</code></pre>
                        </div>
                        
                        <div class="grid">
                          <div class="card">
                            <h3>📋 Setting Details</h3>
                            <table style="width: 100%; border-collapse: collapse;">
                              <tr style="border-bottom: 1px solid var(--vscode-border);">
                                <th style="text-align: left; padding: 8px;">Setting</th>
                                <th style="text-align: left; padding: 8px;">Description</th>
                              </tr>
                              <tr>
                                <td style="padding: 8px;"><code>enabled</code></td>
                                <td style="padding: 8px;">🔛 Enable/disable notifications</td>
                              </tr>
                              <tr>
                                <td style="padding: 8px;"><code>logLevel</code></td>
                                <td style="padding: 8px;">📊 Logging level (error/warn/info/debug)</td>
                              </tr>
                              <tr>
                                <td style="padding: 8px;"><code>minimumKeys</code></td>
                                <td style="padding: 8px;">🔢 Minimum keys required for notifications</td>
                              </tr>
                              <tr>
                                <td style="padding: 8px;"><code>showCommandName</code></td>
                                <td style="padding: 8px;">📝 Show command name in notifications</td>
                              </tr>
                              <tr>
                                <td style="padding: 8px;"><code>excludedCommands</code></td>
                                <td style="padding: 8px;">🚫 Commands to exclude from notifications</td>
                              </tr>
                            </table>
                          </div>
                        </div>
                      </div>
                    </section>
                    
                    <!-- 🔧 Compatibility Section -->
                    <section id="compatibility" class="section">
                      <div class="container">
                        <h2>🔧 Node.js & VS Code Compatibility</h2>
                        
                        <div class="grid">
                          <div class="card">
                            <h3>🟢 Node.js Support</h3>
                            <p>Tested and supported on:</p>
                            <ul>
                              <li>✅ <strong>Node 16.x</strong> - Minimum supported</li>
                              <li>✅ <strong>Node 18.x</strong> - LTS support</li>
                              <li>✅ <strong>Node 20.x</strong> - Recommended</li>
                              <li>✅ <strong>Node 22.x</strong> - Latest features</li>
                              <li>🚀 <strong>Latest</strong> - Cutting edge</li>
                            </ul>
                          </div>
                          
                          <div class="card">
                            <h3>💻 VS Code Versions</h3>
                            <ul>
                              <li>✅ <strong>VS Code 1.90.0+</strong> - Minimum required</li>
                              <li>✅ <strong>VS Code Stable</strong> - Fully supported</li>
                              <li>✅ <strong>VS Code Insiders</strong> - Beta features</li>
                              <li>🌍 <strong>All Platforms</strong> - Windows, macOS, Linux</li>
                            </ul>
                          </div>
                        </div>
                      </div>
                    </section>
                    
                    <!-- 🤝 Contributing Section -->
                    <section id="contributing" class="section">
                      <div class="container">
                        <h2>🤝 Join Our Community</h2>
                        
                        <div class="grid">
                          <div class="card">
                            <h3>🚀 Development Setup</h3>
                            <pre><code># Clone and setup
                  git clone https://github.com/Vijay431/vscode-keypress_snackbar_notification-extension.git
                  cd vscode-keypress_snackbar_notification-extension
                  pnpm install
                  pnpm test:dev  # Ready to code! 🎉</code></pre>
                          </div>
                          
                          <div class="card">
                            <h3>🎯 Ways to Contribute</h3>
                            <ul>
                              <li>⭐ <strong>Star this repo</strong> if you find it useful</li>
                              <li>🐛 <strong>Report bugs</strong> via GitHub Issues</li>
                              <li>💡 <strong>Suggest features</strong> we should build</li>
                              <li>🔧 <strong>Submit PRs</strong> for fixes or improvements</li>
                              <li>📝 <strong>Improve documentation</strong></li>
                            </ul>
                          </div>
                        </div>
                        
                        <div style="text-align: center; margin-top: 2rem;">
                          <a href="https://github.com/Vijay431/vscode-keypress_snackbar_notification-extension/issues" class="btn">🐛 Report Issues</a>
                          <a href="https://github.com/Vijay431/vscode-keypress_snackbar_notification-extension/pulls" class="btn btn-secondary">🔧 Submit PR</a>
                        </div>
                      </div>
                    </section>
                    
                    <!-- 🏷️ Footer -->
                    <footer style="background: var(--vscode-sidebar); padding: 2rem 0; text-align: center; border-top: 1px solid var(--vscode-border);">
                      <div class="container">
                        <p>Made with ❤️ by <a href="https://github.com/Vijay431" style="color: var(--vscode-accent);">Vijay Gangatharan</a></p>
                        <p>🚀 <strong>Happy coding!</strong> 🎉</p>
                      </div>
                    </footer>
                    
                    <!-- 🚀 JavaScript -->
                    <script src="./assets/js/main.js"></script>
                  </body>
                  </html>
                  EOF

            - name: 📄 Setup Pages configuration
              uses: actions/configure-pages@v5

            - name: 📦 Upload Pages artifact
              uses: actions/upload-pages-artifact@v3
              with:
                  path: ./docs

    deploy:
        name: 🌐 Deploy to GitHub Pages
        needs: build
        runs-on: ubuntu-latest
        if: github.ref == 'refs/heads/master'

        environment:
            name: github-pages
            url: ${{ steps.deployment.outputs.page_url }}

        permissions:
            pages: write
            id-token: write

        steps:
            - name: 🚀 Deploy to GitHub Pages
              id: deployment
              uses: actions/deploy-pages@v4

            - name: 🎉 Deployment Success
              run: |
                  echo "🌐 Documentation site deployed successfully!"
                  echo "🔗 URL: ${{ steps.deployment.outputs.page_url }}"
                  echo "📖 Your extension documentation is now live!"
